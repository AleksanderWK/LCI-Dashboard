import pandas as pd
from datamodels.skeletal import SkeletalNodeCollection
from calculators.esf_calc import EnergySpentFatigue

def test_jiggle():
    calculator = EnergySpentFatigue()
    point0 = SkeletalNodeCollection(test_data[0])
    point1 = SkeletalNodeCollection(test_data[1])
    results = [-1, -1, -1, 0.8076952264009989, -0.8076952264009989, 0.8076952264009989, -0.8076952264009989, 0.8076952264009989]
    assert calculator.calculate_dataset(point0) == results[0]
    assert calculator.calculate_dataset(point1) == results[1]
    assert calculator.calculate_dataset(point0) == results[2]
    assert calculator.calculate_dataset(point1) == results[3]
    assert calculator.calculate_dataset(point0) == results[4]
    assert calculator.calculate_dataset(point1) == results[5]
    assert calculator.calculate_dataset(point0) == results[6]
    assert calculator.calculate_dataset(point1) == results[7]

def test_identical():
    calculator = EnergySpentFatigue()
    point0 = SkeletalNodeCollection(test_data[0])
    results = [-1, -1, -1, -1, -1, -1, -1, -1]
    assert calculator.calculate_dataset(point0) == results[0]
    assert calculator.calculate_dataset(point0) == results[1]
    assert calculator.calculate_dataset(point0) == results[2]
    assert calculator.calculate_dataset(point0) == results[3]
    assert calculator.calculate_dataset(point0) == results[4]
    assert calculator.calculate_dataset(point0) == results[5]
    assert calculator.calculate_dataset(point0) == results[6]
    assert calculator.calculate_dataset(point0) == results[7]

test_data = [
    [
        [0,-0.06503438,-0.4433964,1.93924284,1],
        [1,-0.0566807725,-0.182691678,2.0116806,1],
        [2,-0.0480607077,0.07071667,2.07144785,1],
        [3,-0.025537001,0.201338485,2.0927856,1],
        [4,-0.1974775,-0.04523868,2.05103874,1],
        [5,-0.250345677,-0.278211534,2.0328126,1],
        [6,-0.283549845,-0.4418263,1.95876765,1],
        [7,-0.276539475,-0.493029028,1.92698956,1],
        [8,0.09831214,-0.0547792874,2.01461959,1],
        [9,0.14385891,-0.224099413,1.93024313,1],
        [10,0.114375219,-0.2732392,1.719964,1],
        [11,0.127884492,-0.245491624,1.65840924,1],
        [12,-0.13046892,-0.436442852,1.91074979,1],
        [13,-0.0891597942,-0.716961861,1.81387675,1],
        [14,-0.1127144,-1.00306869,1.86534321,1],
        [15,-0.06834517,-1.06446373,1.826459,1],
        [16,0.00263005216,-0.4358732,1.90451741,1],
        [17,-0.0174790919,-0.725961,1.859508,1],
        [18,-0.03558844,-0.9888478,1.87299061,1],
        [19,-0.08197573,-1.04613006,1.825441,1],
        [20,-0.0502530746,0.008253686,2.058688,1],
        [21,-0.280073941,-0.5594712,1.90001941,1],
        [22,-0.244306117,-0.494465262,1.89335728,1],
        [23,0.136113137,-0.247130215,1.626485,1],
        [24,0.0857128352,-0.242908612,1.66800034,1]
    ],
    [
        [0,-0.06559665,-0.4493129,1.95263064,2],
        [1,-0.0488153137,-0.188991785,2.0280447,2],
        [2,-0.0325029679,0.0640679747,2.091529,2],
        [3,-0.0119740833,0.193454638,2.11266637,2],
        [4,-0.187301636,-0.0523124933,2.07873249,2],
        [5,-0.240003526,-0.294960916,2.05029678,2],
        [6,-0.268927962,-0.4574356,1.96273088,2],
        [7,-0.259117365,-0.487634838,1.92920828,2],
        [8,0.1069164,-0.06293873,2.02442479,2],
        [9,0.137911126,-0.242482,1.98164737,2],
        [10,0.162566021,-0.26794067,1.79268277,2],
        [11,0.15203166,-0.276196241,1.67361367,2],
        [12,-0.131435812,-0.442149967,1.927716,2],
        [13,-0.07391176,-0.6969284,1.848491,2],
        [14,-0.0578834526,-0.9895417,1.908207,2],
        [15,-0.0246234313,-1.031934,1.81973732,2],
        [16,0.00245462055,-0.441992581,1.914174,2],
        [17,-0.0682406947,-0.7459773,1.85668766,2],
        [18,-0.029050231,-0.990687966,1.88217008,2],
        [19,-0.0502307639,-1.06118023,1.83998573,2],
        [20,-0.03657405,0.001669419,2.07780933,2],
        [21,-0.264126867,-0.5526948,1.89681935,2],
        [22,-0.226956338,-0.49484393,1.89700007,2],
        [23,0.164764971,-0.304290682,1.62963545,2],
        [24,0.1085493,-0.2733874,1.6865555,2]
    ]
]